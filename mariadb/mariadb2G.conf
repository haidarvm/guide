[mysqld]
# ===============================
# Basic Settings
# ===============================
user                            = mysql
default_storage_engine          = InnoDB
skip_name_resolve               = 1
log-error=/var/log/mysql/mariadb.log
log_warnings = 1
#general_log
#general_log_file=/var/log/mariadb/query.log
#pid-file=/run/mariadb/mariadb.pid
slow_query_log
slow_query_log_file	= /var/log/mysql/mysql-slow.log
long_query_time = 5

# ===============================
# InnoDB Engine
# ===============================
innodb_buffer_pool_instances    = 1
innodb_buffer_pool_size         = 1024M        # ~50â€“60% of total RAM
innodb_file_per_table           = 1
innodb_flush_log_at_trx_commit  = 2
innodb_flush_method             = O_DIRECT
innodb_log_buffer_size          = 8M
innodb_log_file_size            = 128M         # reduced for faster recovery on small VPS
innodb_stats_on_metadata        = 0
innodb_read_io_threads          = 2
innodb_write_io_threads         = 2
innodb_io_capacity              = 200
innodb_io_capacity_max          = 400
innodb_buffer_pool_load_at_startup = 1
innodb_buffer_pool_dump_at_shutdown = 1
innodb_lock_wait_timeout        = 50

# ===============================
# MyISAM (legacy)
# ===============================
key_buffer_size                 = 16M
myisam_recover_options          = FORCE,BACKUP
concurrent_insert               = 2
low_priority_updates            = 1

# ===============================
# Query Cache (MariaDB only)
# ===============================
query_cache_type                = 1
query_cache_size                = 32M
query_cache_limit               = 2M

# ===============================
# Connections & Threads
# ===============================
max_connections                 = 80
back_log                        = 256
thread_cache_size               = 32
thread_stack                    = 192K

interactive_timeout             = 120
wait_timeout                    = 120

# ===============================
# Temporary Tables
# ===============================
tmp_table_size                  = 64M
max_heap_table_size             = 64M
table_open_cache                = 2048
table_definition_cache          = 2048

# ===============================
# Buffers
# ===============================
join_buffer_size                = 512K
read_buffer_size                = 512K
read_rnd_buffer_size            = 512K
sort_buffer_size                = 1M

# ===============================
# Logging & Performance
# ===============================
slow_query_log                  = 1
slow_query_log_file             = /var/log/mysql/slow.log
long_query_time                 = 3
log_error                       = /var/log/mysql/error.log

max_allowed_packet              = 64M
max_statement_time              = 30
open_files_limit                = 65535

# ===============================
# Character Set & Collation
# ===============================
character-set-server            = utf8mb4
collation-server                = utf8mb4_general_ci

# ===============================
# Misc / Safety
# ===============================
skip-external-locking
performance_schema              = ON
